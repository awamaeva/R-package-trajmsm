---
title: "Latent class growth models and Marginal Structural Models"
authors: Awa Diop, Denis Talbot
date: june 2022
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{trajMSM}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

# Introduction

Latent class growth Analysis (LCGA) are increasingly proposed
as a solution to summarize the observed longitudinal treatment in a few distinct groups.
combined with standard approaches like Cox proportional hazards models, LCGA can fail to
control time-dependent confounding bias because of time-varying covariates that have a dou-
ble role of confounders and mediators. We propose to use LCGA to classify individuals into a
few latent classes based on their medication adherence pattern, then choose a working marginal structural model (MSM) that relates the outcome to these groups. The parameter of interest is nonparametrically defined as the projection of the true MSM onto the chosen working model.The combination of LCGA with MSM (LCGA-MSM) is a convenient way to describe treatment adherence and can effectively control time-dependent confounding.

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(trajMSM)
```


# Latent class growth models (LCGA)
```{r}
Obsdata = gendatatraj()
Rdat = longformat(Obsdata = Obsdata, varying = 1:5)
head(Rdat)
```

```{r message=TRUE, warning=FALSE}

res.traj = buildtraj(Rdat = Rdat, k=3,formula = cbind(A,1-A) ~ time, id="id")
dpost = res.traj$dpost
head(dpost)
plotraj(Rdat = Rdat, dpost = dpost, formula = A ~ time + class,
trt = "A",time = "time",id="id",class = "class", FUN = "mean")

```


# Marginal Structural Models (MSM)

# Estimation methods

# LCGA-MSM with IPTW
# Conclusion
